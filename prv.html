<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <title>【醫院 LINE 衛教服務】隱私權與個人資料保護聲明</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- 簡單手機版排版 -->
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    h1 {
      font-size: 1.4rem;
      margin-top: 0;
      margin-bottom: 12px;
      color: #0f766e;
    }
    h2 {
      font-size: 1.1rem;
      margin-top: 18px;
      margin-bottom: 6px;
      color: #0f766e;
    }
    p {
      margin: 4px 0 8px;
      font-size: 0.95rem;
    }
    ul {
      padding-left: 20px;
      margin: 4px 0 8px;
      font-size: 0.95rem;
    }
    .highlight {
      background: #ecfdf3;
      border-left: 4px solid #16a34a;
      padding: 8px 10px;
      border-radius: 6px;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    .footer-note {
      font-size: 0.8rem;
      color: #666;
      margin-top: 12px;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    button {
      flex: 1 1 120px;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
      white-space: nowrap;
    }
    button:active {
      transform: scale(0.97);
      box-shadow: 0 0 0 0 rgba(0,0,0,0.1);
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn-primary {
      background: #0f766e;
      color: #ffffff;
      box-shadow: 0 3px 10px rgba(15,118,110,0.35);
    }
    .center {
      text-align: center;
    }
    .small {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .error {
      color: #b91c1c;
      font-size: 0.85rem;
      margin-top: 8px;
      display: none;
    }
    .success {
      color: #15803d;
      font-size: 0.9rem;
      margin-top: 8px;
      display: none;
    }
  </style>

  <!-- LIFF SDK（正式上線請改用官方最新版 CDN） -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>【醫院 LINE 衛教服務】隱私權與個人資料保護聲明</h1>

      <div class="highlight">
        為提供個人化的衛教資訊與諮詢服務，本 LINE 官方帳號會記錄您與機器人的對話內容。<br>
        我們非常重視您的個人資料與隱私，請您詳細閱讀本聲明並確認是否同意。
      </div>

      <p>
        本聲明由「<strong>（請填入醫院名稱，例如：○○動物醫院）</strong>」（以下稱「本院」）就您使用本院
        LINE 官方帳號及相關衛教服務時，如何蒐集、處理及利用您的個人資料，向您說明如下。
      </p>

      <h2>一、資料蒐集目的</h2>
      <p>本院基於下列目的，蒐集並利用您的個人資料與對話內容：</p>
      <ul>
        <li>提供醫療及衛教諮詢服務</li>
        <li>記錄對話內容，以便後續追蹤及查詢諮詢紀錄</li>
        <li>改善本院醫療服務品質與衛教內容（如常見問題統計與內容優化）</li>
        <li>必要之身份識別、聯絡及客戶關係維護</li>
        <li>符合法令或主管機關之要求</li>
      </ul>

      <h2>二、蒐集之個人資料類型</h2>
      <p>視您實際提供之情況，本院可能蒐集的資料包括：</p>
      <ul>
        <li>LINE 用戶識別資料：如 LINE User ID、暱稱、大頭貼等公開資料</li>
        <li>聯絡方式：如您主動提供之姓名、電話、電子郵件等</li>
        <li>就醫或健康相關資訊：例如您在對話中提及的症狀、用藥情形、檢查結果等</li>
        <li>使用紀錄：包含對話內容、使用時間、詢問主題等</li>
      </ul>
      <p class="small">
        ⚠️ 請勿在 LINE 對話中輸入身分證字號、完整地址、金融帳號等過度敏感資訊。
        如有必要，本院將改以電話或臨櫃方式與您聯繫。
      </p>

      <h2>三、利用期間、地區、對象及方式</h2>
      <ul>
        <li><strong>利用期間：</strong>自您同意之日起，至蒐集目的消失或本院停止提供該服務後，或依相關法令規定之保存期間。</li>
        <li><strong>利用地區：</strong>本院所在地及本院所使用之雲端服務器所在地（目前主要位於台灣或契約約定之地區）。</li>
        <li><strong>利用對象：</strong>本院及受本院委託之協力廠商（如系統開發與維運廠商），並皆負有保密義務。</li>
        <li><strong>利用方式：</strong>以電子資料庫或紙本方式，作為提供醫療與衛教服務之參考、紀錄及統計分析，並依相關法令及資安規範妥善保護。</li>
      </ul>

      <h2>四、資料安全與保護措施</h2>
      <ul>
        <li>本院採取合適之資訊安全措施（如存取權限控管、加密傳輸、紀錄追蹤等），以防止未經授權之存取、洩漏、竄改或其他侵害。</li>
        <li>受委託處理資料之廠商，均簽署保密條款並負有約定之資料保護義務。</li>
        <li>對話紀錄僅限經授權之醫護人員與必要之系統維運人員於執行職務時使用。</li>
      </ul>

      <h2>五、您的權利</h2>
      <p>依據台灣個人資料保護法，您就您的個人資料得行使以下權利：</p>
      <ul>
        <li>查詢或請求閱覽</li>
        <li>請求製給複製本</li>
        <li>請求補充或更正</li>
        <li>請求停止蒐集、處理或利用</li>
        <li>請求刪除</li>
      </ul>
      <p>
        如欲行使上述權利，請與本院聯繫：
        <br>聯絡窗口：<strong>（請填入單位，例如：醫療資訊室 / 客服中心）</strong>
        <br>電話：<strong>（請填入電話）</strong>
        <br>E-mail：<strong>（請填入聯絡信箱）</strong>
      </p>

      <h2>六、不同意提供資料之影響</h2>
      <p>
        您得自由選擇是否提供前述資料。但若您拒絕提供、提供不完整或要求本院停止利用或刪除相關資料，可能導致：
      </p>
      <ul>
        <li>無法透過 LINE 提供完整之衛教或諮詢服務</li>
        <li>無法查詢過去諮詢紀錄或提供後續追蹤提醒</li>
      </ul>

      <h2>七、聲明更新</h2>
      <p>
        本院得視實際需求、法令變更或資安要求，不定期修訂本聲明。
        如有重大變更，將於本頁面或本院官網公告。
      </p>

      <p class="footer-note">
        當您點選「同意並開始使用」並繼續使用本 LINE 衛教服務，即表示您已閱讀、瞭解並同意本聲明之全部內容。
      </p>

      <div class="btn-group">
        <button class="btn-secondary" id="btn-decline">不同意，離開頁面</button>
        <button class="btn-primary" id="btn-accept">同意並開始使用</button>
      </div>

      <div id="msg-error" class="error">發生錯誤，請稍後再試，或改用電話與本院聯繫。</div>
      <div id="msg-success" class="success">已記錄您的同意，您可以回到 LINE 繼續使用服務。</div>

      <p class="footer-note">
        ※ 本頁面僅供範本使用，實際條款內容請依貴院法遵與律師審閱後為準。
      </p>
    </div>
  </div>

  <script>
    // ==== 設定區：請改成自己的參數 ====
    const LIFF_ID = "2008560306-pkV831L7";  // TODO: 換成你的 LIFF ID
    const CONSENT_API_ENDPOINT = "https://26503b67c3e9.ngrok-free.app/api/consent"; // TODO: 後端 API URL

    async function initLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });

        // 若在 LINE 內打開才有意義；若在瀏覽器獨立開啟，可依需求決定是否允許
        if (!liff.isInClient()) {
          console.log("Not opened in LINE client.");
        }
      } catch (err) {
        console.error("LIFF init error", err);
        showError("LIFF 初始化失敗，請稍後再試。");
      }
    }

    function showError(msg) {
      const el = document.getElementById("msg-error");
      el.textContent = msg;
      el.style.display = "block";
    }

    function showSuccess(msg) {
      const el = document.getElementById("msg-success");
      el.textContent = msg;
      el.style.display = "block";
    }

    // 使用者按「同意」
    async function handleAccept() {
      try {
        const profile = await liff.getProfile();
        const userId = profile.userId;

        const payload = {
          userId,
          consent: true,
          source: "liff",
          consentVersion: "v1",   // 之後更新條款可以改版本
          consentAt: new Date().toISOString()
        };

        const res = await fetch(CONSENT_API_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          throw new Error("API response not ok");
        }

        showSuccess("已成功記錄您的同意，謝謝。");
        // 若在 LINE 內，可自動關閉 LIFF 回到聊天室
        if (liff.isInClient()) {
          setTimeout(() => liff.closeWindow(), 1000);
        }

      } catch (err) {
        console.error("consent error", err);
        showError("傳送同意資料時發生錯誤，請稍後再試。");
      }
    }

    // 使用者按「不同意」
    function handleDecline() {
      // 你可以改成導到官網、顯示說明頁等等
      if (liff.isInClient()) {
        alert("您尚未同意使用本 LINE 衛教服務，如有醫療需求，請改用電話或現場掛號。");
        liff.closeWindow();
      } else {
        window.location.href = "https://google.com"; // TODO: 或導回醫院官網
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      initLiff();

      document.getElementById("btn-accept")
        .addEventListener("click", handleAccept);

      document.getElementById("btn-decline")
        .addEventListener("click", handleDecline);
    });
  </script>
</body>
</html>

